<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Flugsuche</ion-title>
  </ion-toolbar>
</ion-header>

<!-- Statische OSM-Karte ganz oben -->
<div class="map-container">
  <iframe
    class="map-iframe"
    src="https://www.openstreetmap.org/export/embed.html?bbox=10.0%2C50.0%2C11.0%2C51.0&amp;layer=mapnik"
    allowfullscreen
    loading="lazy"
    style="width: 100%; height: 200px; border-radius: 12px; border: none;"
  ></iframe>
</div>

<ion-content [fullscreen]="true">
  <div class="background-container">
    <img src="./assets/Background.png" alt="Hintergrundbild" class="background-image" />
  </div>

  <div class="flight-info">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          {{selectedDeparture?.iata}} → {{selectedArrival?.iata}}
        </ion-card-title>
        <ion-card-subtitle>
          Abflug: {{departureDate | date:'dd.MM.yyyy'}}
          <span *ngIf="returnDate">
            | Rückflug: {{returnDate | date:'dd.MM.yyyy'}}
          </span>
        </ion-card-subtitle>
      </ion-card-header>
    </ion-card>

    <ion-accordion-group *ngIf="countryInfo">
      <ion-accordion value="countryInfo">
        <ion-item slot="header" color="light">
          <ion-label>
            <h2>Reiseinformationen für {{countryInfo.name}}</h2>
            <p>{{countryInfo.capital}} | {{countryInfo.region}}</p>
          </ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          <ion-list>
            <ion-item>
              <ion-label>
                <h2>Visum</h2>
                <p>{{countryInfo.travelRequirements.visa.type}}</p>
                <p>Gültigkeitsdauer: {{countryInfo.travelRequirements.visa.duration}}</p>
              </ion-label>
            </ion-item>

            <ion-item>
              <ion-label>
                <h2>Benötigte Impfungen</h2>
                <p *ngFor="let vaccine of countryInfo.travelRequirements.vaccinations">
                  • {{vaccine}}
                </p>
              </ion-label>
            </ion-item>

            <ion-item>
              <ion-label>
                <h2>Benötigte Dokumente</h2>
                <p *ngFor="let doc of countryInfo.travelRequirements.documents">
                  • {{doc}}
                </p>
              </ion-label>
            </ion-item>
          </ion-list>
        </div>
      </ion-accordion>
    </ion-accordion-group>

    <ion-accordion-group *ngIf="registeredPassengers.length > 0">
      <ion-accordion value="passengers">
        <ion-item slot="header" color="light">
          <ion-label>
            <h2>Registrierte Passagiere</h2>
          </ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          <ion-list>
            <ion-item *ngFor="let passenger of registeredPassengers">
              <ion-label>
                <h2>{{passenger.firstName}} {{passenger.lastName}}</h2>
                <p>Ticket: TK{{passenger.ticketNumber}}</p>
                <ng-container *ngIf="getEntryStatusForPassenger(passenger) as entryStatus">
                  <p [ngStyle]="{
                    color: entryStatus.allowed ? 'green' : 'red',
                    fontWeight: 'bold',
                    margin: '0.5em 0 0 0'
                  }">
                    <ion-icon [name]="entryStatus.allowed ? 'checkmark-circle' : 'close-circle'" style="vertical-align: middle;"></ion-icon>
                    {{ entryStatus.allowed ? 'Einreise erlaubt' : 'Einreise nicht erlaubt' }}
                    <span style="font-weight: normal; color: #888;">({{entryStatus.reason}})</span>
                  </p>
                </ng-container>
              </ion-label>
            </ion-item>
          </ion-list>
        </div>
      </ion-accordion>
    </ion-accordion-group>

    <ion-list *ngIf="flights.length > 0">
      <ion-list-header>
        <ion-label>Hinflüge</ion-label>
      </ion-list-header>
      <ion-item *ngFor="let flight of flights">
        <ion-label>
          <h2>{{flight.number}} - {{flight.airline?.name || 'Unbekannt'}}</h2>
          <p>Abflug: {{flight.departure.scheduledTime | date:'HH:mm'}}</p>
          <p>Ankunft: {{flight.arrival?.airport?.name || 'Unbekannt'}}</p>
        </ion-label>
      </ion-item>
    </ion-list>

    <ion-list *ngIf="returnFlights.length > 0">
      <ion-list-header>
        <ion-label>Rückflüge</ion-label>
      </ion-list-header>
      <ion-item *ngFor="let flight of returnFlights">
        <ion-label>
          <h2>{{flight.number}} - {{flight.airline?.name || 'Unbekannt'}}</h2>
          <p>Abflug: {{flight.departure.scheduledTime | date:'HH:mm'}}</p>
          <p>Ankunft: {{flight.arrival?.airport?.name || 'Unbekannt'}}</p>
        </ion-label>
      </ion-item>
    </ion-list>

    <div *ngIf="isLoading" class="loading-spinner">
      <ion-spinner name="crescent"></ion-spinner>
    </div>

    <ion-text *ngIf="!isLoading && flights.length === 0" color="medium">
      Keine Flüge gefunden
    </ion-text>

    <ion-text *ngIf="flightsCount > 0" color="success">
      {{flightsCount}} Hinflug-Flüge gefunden
    </ion-text>
  </div>
</ion-content>
